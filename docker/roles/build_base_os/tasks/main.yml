- name: edit yum.repos.d(mirrorlist)
  replace:
    path: '/etc/yum.repos.d/CentOS-Base.repo'
    regexp: '^(mirrorlist=http://mirrorlist.centos.org.*)$'
    replace: '#\1'

- name: edit yum.repos.d(Base)
  replace:
    path: '/etc/yum.repos.d/CentOS-Base.repo'
    regexp: '^#(baseurl=http://)(mirror.centos.org)(.*)$'
    replace: '\1ftp.riken.jp/Linux\3'

- name: Setting environment variables(proxy)
  blockinfile:
    dest: "/etc/profile.d/proxy.sh"
    create: yes
    block: |
      http_proxy=http://{{ gateway }}:3128
      export http_proxy
      https_proxy=http://{{ gateway }}:3128
      export https_proxy

#- name: set proxy to yum
#  lineinfile:
#    path: /etc/yum.conf
#    line: "proxy=http://{{ gateway }}:3128"

- name: yum install centos-release-scl
  yum:
    name: "{{ item }}"
    state: latest
  with_items:
    - centos-release-scl

- name: edit yum.repos.d(centos-sclo-rh)
  replace:
    path: '/etc/yum.repos.d/CentOS-SCLo-scl-rh.repo'
    regexp: '^(baseurl=http://)(mirror.centos.org)(.*)$'
    replace: '\1ftp.riken.jp/Linux\3'

- name: edit yum.repos.d(centos-sclo)
  replace:
    path: '/etc/yum.repos.d/CentOS-SCLo-scl.repo'
    regexp: '^(baseurl=http://)(mirror.centos.org)(.*)$'
    replace: '\1ftp.riken.jp/Linux\3'

- name: yum update
  yum:
    name: "*"
    state: latest
